<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go Library å›¾ä¹¦ç®¡ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <!-- ç™»å½•/æ³¨å†Œæ¨¡æ€æ¡† -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">ç™»å½•</h2>
                <button class="close-btn" onclick="closeAuthModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="authForm">
                    <div id="registerFields" style="display: none;">
                        <input type="email" id="regEmail" placeholder="é‚®ç®±åœ°å€">
                        <input type="text" id="regRealName" placeholder="çœŸå®å§“åï¼ˆå¯é€‰ï¼‰">
                        <input type="text" id="regPhone" placeholder="ç”µè¯ï¼ˆå¯é€‰ï¼‰">
                    </div>
                    <input type="text" id="authUsername" placeholder="ç”¨æˆ·å" required>
                    <input type="password" id="authPassword" placeholder="å¯†ç " required>
                    <button type="submit" id="authSubmit">ç™»å½•</button>
                </form>
                <div class="auth-switch">
                    <span id="switchText">è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ</span>
                    <a href="#" id="switchLink" onclick="switchAuthMode()">ç«‹å³æ³¨å†Œ</a>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸»åº”ç”¨ç•Œé¢ -->
    <div class="container" id="appContainer" style="display: none;">
        <header>
            <h1>ğŸ“š Go Library å›¾ä¹¦ç®¡ç†ç³»ç»Ÿ</h1>
            <p>åŸºäº Go + Gin + openGauss çš„å›¾ä¹¦å€Ÿé˜…ç®¡ç†ç³»ç»Ÿ</p>
            <div class="user-info">
                <span class="badge">æ¬¢è¿, <strong id="currentUsername">ç”¨æˆ·</strong></span>
                <span class="badge" id="userRole">è¯»è€…</span>
                <button id="logoutBtn" class="logout-btn">é€€å‡ºç™»å½•</button>
            </div>
        </header>

        <!-- ç»Ÿè®¡é¢æ¿ -->
        <div class="stats-panel" id="statsPanel">
            <div class="stat-card">
                <div class="stat-value" id="totalBooks">0</div>
                <div class="stat-label">å›¾ä¹¦æ€»æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalBorrowed">0</div>
                <div class="stat-label">å·²å€Ÿå‡º</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalAvailable">0</div>
                <div class="stat-label">å¯å€Ÿé˜…</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="activeBorrowings">0</div>
                <div class="stat-label">å€Ÿé˜…ä¸­</div>
            </div>
        </div>

        <!-- å¯¼èˆªæ ‡ç­¾ -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="books">å›¾ä¹¦æµè§ˆ</button>
            <button class="tab-btn" data-tab="borrowings">æˆ‘çš„å€Ÿé˜…</button>
            <button class="tab-btn admin-only" data-tab="manage" style="display: none;">å›¾ä¹¦ç®¡ç†</button>
        </div>

        <!-- å›¾ä¹¦æµè§ˆæ ‡ç­¾é¡µ -->
        <div id="booksTab" class="tab-content active">
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="æœç´¢å›¾ä¹¦ï¼ˆä¹¦åã€ä½œè€…ã€ISBNï¼‰...">
                <select id="categoryFilter">
                    <option value="">æ‰€æœ‰åˆ†ç±»</option>
                </select>
                <label><input type="checkbox" id="availableOnly"> ä»…æ˜¾ç¤ºå¯å€Ÿ</label>
            </div>

            <div id="bookList" class="book-grid"></div>
        </div>

        <!-- æˆ‘çš„å€Ÿé˜…æ ‡ç­¾é¡µ -->
        <div id="borrowingsTab" class="tab-content">
            <div class="filters">
                <button class="filter-btn active" data-status="">å…¨éƒ¨</button>
                <button class="filter-btn" data-status="borrowed">å€Ÿé˜…ä¸­</button>
                <button class="filter-btn" data-status="returned">å·²å½’è¿˜</button>
                <button class="filter-btn" data-status="overdue">å·²é€¾æœŸ</button>
            </div>
            <div id="borrowingList" class="borrowing-list"></div>
        </div>

        <!-- å›¾ä¹¦ç®¡ç†æ ‡ç­¾é¡µï¼ˆç®¡ç†å‘˜ï¼‰ -->
        <div id="manageTab" class="tab-content admin-only" style="display: none;">
            <button class="btn-primary" onclick="showAddBookForm()">+ æ·»åŠ æ–°å›¾ä¹¦</button>
            <div id="manageBookList" class="book-grid"></div>
        </div>

        <footer>
            <span>Powered by Go Â· Gin Â· openGauss Â· RISC-V</span>
            <span class="api-status" id="apiStatus">API è¿æ¥ä¸­...</span>
        </footer>
    </div>

    <!-- å›¾ä¹¦è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="bookModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="bookModalTitle">å›¾ä¹¦è¯¦æƒ…</h2>
                <button class="close-btn" onclick="closeBookModal()">&times;</button>
            </div>
            <div class="modal-body" id="bookModalBody"></div>
        </div>
    </div>

    <!-- æ·»åŠ /ç¼–è¾‘å›¾ä¹¦æ¨¡æ€æ¡† -->
    <div id="bookFormModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="bookFormTitle">æ·»åŠ å›¾ä¹¦</h2>
                <button class="close-btn" onclick="closeBookFormModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="bookForm">
                    <input type="hidden" id="bookId">
                    <input type="text" id="bookISBN" placeholder="ISBNï¼ˆå¯é€‰ï¼‰">
                    <input type="text" id="bookTitle" placeholder="ä¹¦å *" required>
                    <input type="text" id="bookAuthor" placeholder="ä½œè€… *" required>
                    <input type="text" id="bookPublisher" placeholder="å‡ºç‰ˆç¤¾">
                    <input type="date" id="bookPublishDate" placeholder="å‡ºç‰ˆæ—¥æœŸ">
                    <select id="bookCategory" required>
                        <option value="">é€‰æ‹©åˆ†ç±» *</option>
                    </select>
                    <input type="number" id="bookCopies" placeholder="å‰¯æœ¬æ•°é‡" min="1" value="1">
                    <input type="text" id="bookLocation" placeholder="ä½ç½®ï¼ˆå¦‚ï¼šA1-001ï¼‰">
                    <textarea id="bookDescription" placeholder="å›¾ä¹¦ç®€ä»‹" rows="3"></textarea>
                    <input type="text" id="bookCover" placeholder="å°é¢å›¾ç‰‡URLï¼ˆå¯é€‰ï¼‰">
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">ä¿å­˜</button>
                        <button type="button" class="btn-secondary" onclick="closeBookFormModal()">å–æ¶ˆ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        window.__API_BASE__ = window.location.pathname.startsWith("/go-library")
            ? "/go-library/api"
            : "/api";
        window.__AUTH_BASE__ = window.location.pathname.startsWith("/go-library")
            ? "/go-library/api/auth"
            : "/api/auth";
    </script>
    <script src="./app.js"></script>
</body>
</html>
